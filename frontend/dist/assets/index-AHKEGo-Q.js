import{r as a,j as e,w as M,F as _,l as O,o as R,p as Z,x as q,y as B,A as g}from"./index-B_fXl06b.js";const J=()=>{const[S,A]=a.useState([]),[U,n]=a.useState(!0),[G,N]=a.useState(null),[v,F]=a.useState(""),[I,u]=a.useState(!1),[l,x]=a.useState(null),[o,d]=a.useState({name:"",email:"",role:"CITIZEN",password:""}),[C,p]=a.useState(null),[r,P]=a.useState(1),b=10,y=async()=>{try{n(!0);const s=localStorage.getItem("token"),t=await fetch(`${g}/users`,{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error("Failed to fetch users");const i=await t.json();A(i.data.users)}catch(s){N(s instanceof Error?s.message:"An error occurred")}finally{n(!1)}};a.useEffect(()=>{y()},[]);const h=s=>{const{name:t,value:i}=s.target;d(f=>({...f,[t]:i}))},T=async s=>{s.preventDefault();try{p(null),n(!0);const t=localStorage.getItem("token"),i=l?`${g}/users/${l._id}`:`${g}/auth/register`,f=await fetch(i,{method:l?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(o)});if(!f.ok){const D=await f.json();throw new Error(D.message||"Failed to save user")}await y(),u(!1),x(null),d({name:"",email:"",role:"CITIZEN",password:""})}catch(t){p(t instanceof Error?t.message:"An error occurred")}finally{n(!1)}},L=s=>{x(s),d({name:s.name,email:s.email,role:s.role,password:""}),u(!0)},$=async s=>{if(window.confirm("Are you sure you want to delete this user?"))try{n(!0);const t=localStorage.getItem("token");if(!(await fetch(`${g}/users/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to delete user");await y()}catch(t){N(t instanceof Error?t.message:"An error occurred")}finally{n(!1)}},z=()=>{u(!1),p(null),x(null),d({name:"",email:"",role:"CITIZEN",password:""})},c=S.filter(s=>{const t=v.toLowerCase();return s.name.toLowerCase().includes(t)||s.email.toLowerCase().includes(t)||s.role.toLowerCase().includes(t)}),j=r*b,k=j-b,E=c.slice(k,j),w=Math.ceil(c.length/b),m=s=>{P(s)};return U?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-32 w-32 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Users"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage system users and their roles."})]}),e.jsxs("button",{onClick:()=>{x(null),d({name:"",email:"",role:"CITIZEN",password:""}),u(!0)},className:"inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Add User"]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(_,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:v,onChange:s=>F(s.target.value),placeholder:"Search by name, email or role...",className:"block w-full rounded-md border-0 py-1.5 pl-10 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-1 focus:ring-inset focus:ring-blue-600 outline-none sm:text-sm sm:leading-6"})]})}),e.jsx("div",{className:"overflow-hidden rounded-lg bg-white shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found matching your search"})}):E.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:s.profilePicture?e.jsx("img",{className:"h-10 w-10 rounded-full",src:s.profilePicture,alt:s.name}):e.jsx(O,{className:"h-10 w-10 text-gray-400"})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${s.role==="ADMIN"?"bg-purple-100 text-purple-800":s.role==="AGENCY_STAFF"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.email}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>L(s),className:"text-blue-600 hover:text-blue-900 mr-4",children:e.jsx(R,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>$(s._id),className:"text-red-600 hover:text-red-900",children:e.jsx(Z,{className:"h-5 w-5"})})]})]},s._id))})]})}),c.length>0&&e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>m(r-1),disabled:r===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>m(r+1),disabled:r===w,className:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:k+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(j,c.length)})," ","of ",e.jsx("span",{className:"font-medium",children:c.length})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>m(r-1),disabled:r===1,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(q,{className:"h-5 w-5","aria-hidden":"true"})]}),[...Array(w)].map((s,t)=>e.jsx("button",{onClick:()=>m(t+1),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${r===t+1?"z-10 bg-blue-600 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:t+1},t+1)),e.jsxs("button",{onClick:()=>m(r+1),disabled:r===w,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(B,{className:"h-5 w-5","aria-hidden":"true"})]})]})})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-10 max-w-md w-full",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:l?"Edit User":"Add New User"}),C&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600",children:C})}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:h,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:o.email,onChange:h,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{name:"role",value:o.role,onChange:h,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",children:[e.jsx("option",{value:"CITIZEN",children:"Citizen"}),e.jsx("option",{value:"AGENCY_STAFF",children:"Agency Staff"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),!l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{type:"password",name:"password",value:o.password,onChange:h,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",required:!l})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:z,className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:l?"Update":"Create"})]})]})]})})]})};export{J as default};
