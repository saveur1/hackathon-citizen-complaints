import{i as W,u as G,r as l,j as e,F as H,m as J,e as K,n as Q,o as X,p as Y,A as N}from"./index-4SRNKfH5.js";const ee=()=>{var _;const{agencies:h,fetchAgencies:w,loading:F}=W(),{complaints:C}=G(),[g,T]=l.useState(""),[M,b]=l.useState(!1),[I,E]=l.useState(!1),[a,x]=l.useState(null),[n,O]=l.useState(1),f=9,[r,p]=l.useState({name:"",description:"",contactEmail:"",serviceList:""}),[k,o]=l.useState(null),[$,S]=l.useState(!1),u=s=>{const{name:t,value:c}=s.target;p(d=>({...d,[t]:c})),o(null)},B=async s=>{s.preventDefault();try{o(null);const t=localStorage.getItem("token"),c=a?`${N}/agencies/${a._id}`:`${N}/agencies`,d={name:r.name,description:r.description,contactEmail:r.contactEmail,serviceCategories:r.serviceList.split(",").map(m=>m.trim()).filter(m=>m.length>0)},P=await fetch(c,{method:a?"PATCH":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(d)});if(!P.ok){const m=await P.json();throw new Error(m.message||"Failed to save agency")}await w(),A()}catch(t){o(t instanceof Error?t.message:"An error occurred")}},R=s=>{var t;x(s),p({name:s.name,description:s.description,contactEmail:s.contactEmail,serviceList:((t=s.serviceCategories)==null?void 0:t.join(", "))||""}),b(!0)},A=()=>{b(!1),x(null),p({name:"",description:"",contactEmail:"",serviceList:""}),o(null)},V=s=>{x(s),E(!0)},q=()=>{E(!1),x(null)},z=async s=>{if(window.confirm("Are you sure you want to delete this agency? This action cannot be undone."))try{S(!0);const t=localStorage.getItem("token"),c=await fetch(`${N}/agencies/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!c.ok){const d=await c.json();throw new Error(d.message||"Failed to delete agency")}await w()}catch(t){o(t instanceof Error?t.message:"An error occurred")}finally{S(!1)}},i=h==null?void 0:h.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||s.description.toLowerCase().includes(g.toLowerCase())),D=n*f,U=D-f,y=i==null?void 0:i.slice(U,D),j=Math.ceil(((i==null?void 0:i.length)||0)/f),v=s=>{O(s)},L=s=>C.filter(t=>t.handledBy._id===s).length;return F?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-32 w-32 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600",children:"Loading agencies..."})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Agencies"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage and view all government agencies in the system."})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(H,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:g,onChange:s=>T(s.target.value),placeholder:"Search agencies...",className:"block w-full rounded-md border-0 py-1.5 pl-10 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-blue-600 sm:text-sm sm:leading-6"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"ml-4 inline-flex items-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Add Agency"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:y==null?void 0:y.map(s=>e.jsxs("div",{className:"relative flex flex-col overflow-hidden rounded-lg bg-white shadow hover:shadow-md transition-shadow duration-200",children:[e.jsx("div",{className:"flex h-48 flex-shrink-0 items-center justify-center bg-gray-100",children:e.jsx(K,{className:"h-16 w-16 text-gray-400"})}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between p-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:s.description})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[L(s._id)," complaints"]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>V(s),className:"text-amber-600 hover:text-amber-500",title:"View Details",children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>R(s),className:"text-blue-600 hover:text-blue-500",title:"Edit Agency",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>z(s._id),disabled:$,className:"text-red-600 hover:text-red-500 disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Agency",children:e.jsx(Y,{className:"h-5 w-5"})})]})]})]})]},s._id))}),j>1&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>v(n-1),disabled:n===1,className:"px-3 py-1 rounded-md border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),[...Array(j)].map((s,t)=>e.jsx("button",{onClick:()=>v(t+1),className:`px-3 py-1 rounded-md text-sm font-medium ${n===t+1?"bg-blue-600 text-white":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:t+1},t+1)),e.jsx("button",{onClick:()=>v(n+1),disabled:n===j,className:"px-3 py-1 rounded-md border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})}),I&&a&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-10 max-w-2xl w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Agency Details"}),e.jsxs("button",{onClick:q,className:"text-gray-400 hover:text-gray-500",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Name"}),e.jsx("p",{className:"mt-1 text-lg text-gray-900",children:a.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-lg text-gray-900",children:a.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Contact Email"}),e.jsx("p",{className:"mt-1 text-lg text-gray-900",children:a.contactEmail})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Service Categories"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-2",children:(_=a.serviceCategories)==null?void 0:_.map((s,t)=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:s},t))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Complaints"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-lg text-gray-900",children:["Total Complaints: ",L(a._id)]}),e.jsx("div",{className:"mt-4 space-y-3",children:C.filter(s=>s.handledBy._id===a._id).slice(0,3).map(s=>{var t;return e.jsxs("div",{className:"bg-gray-100 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="SUBMITTED"?"bg-gray-100 text-gray-800":s.status==="UNDER_REVIEW"?"bg-yellow-100 text-yellow-800":s.status==="IN_PROGRESS"?"bg-blue-100 text-blue-800":s.status==="RESOLVED"?"bg-green-100 text-green-800":s.status==="ESCALATED"?"bg-purple-100 text-purple-800":"bg-red-100 text-red-800"}`,children:(t=s.status)==null?void 0:t.replace("_"," ")}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleDateString()})]})]},s._id)})})]})]})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-10 max-w-2xl w-full",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:a?"Edit Agency":"Add New Agency"}),k&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600",children:k})}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:u,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:u,rows:3,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Contact Email"}),e.jsx("input",{type:"email",name:"contactEmail",value:r.contactEmail,onChange:u,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Service Categories"}),e.jsx("textarea",{name:"serviceList",value:r.serviceList,onChange:u,placeholder:"Enter services separated by commas (e.g., Service 1, Service 2, Service 3)",rows:3,className:"mt-1 block w-full rounded border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm outline-none",required:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"List all services offered by this agency, separated by commas"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:A,className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:a?"Update":"Create"})]})]})]})})]})};export{ee as default};
